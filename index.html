<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Security-Policy"
content="
default-src 'self';
script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com;
connect-src 'self' https://www.google-analytics.com;
img-src 'self' data: https://www.google-analytics.com;
style-src 'self' 'unsafe-inline';
">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>The SA Wallet | Tax 2026, Affordability, Bond & Vehicle Estimator</title>
<meta name="description" content="The SA Wallet: Free South African financial tools. Estimate 2026 SARS Tax, Vehicle Finance, Bond Repayments, and Affordability.">
<meta name="author" content="The SA Wallet">
<meta name="robots" content="index, follow">

<meta name="google-site-verification" content="rDY2t1_BS93_Cx2VzrG9aqFnOsBi692jFmfGzy_qvNM" />

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="SA Wallet">
<meta name="theme-color" content="#1a202c">

<style>
:root { --bg: #f3f4f6; --card: #ffffff; --text: #1f2937; --primary: #2563eb; --accent: #10b981; --border: #e5e7eb; --danger: #ef4444; --warning: #f59e0b; }
[data-theme="dark"] { --bg: #111827; --card: #1f2937; --text: #f9fafb; --primary: #60a5fa; --accent: #34d399; --border: #374151; --warning: #fcd34d; }

body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; transition: 0.3s; }
.wrapper { max-width: 600px; margin: 0 auto; padding: 15px; min-height: 100vh; }

/* Navigation Tabs */
.nav-tabs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 20px; scrollbar-width: none; }
.nav-tabs::-webkit-scrollbar { display: none; }
.tab-btn { background: var(--card); border: 1px solid var(--border); color: var(--text); padding: 10px 20px; border-radius: 25px; font-weight: 600; white-space: nowrap; cursor: pointer; flex-shrink: 0; transition: 0.2s; font-size: 14px; }
.tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3); }

/* Sections */
.tool-section { display: none; animation: fadeIn 0.4s ease; }
.tool-section.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

/* Cards & Inputs */
.card { background: var(--card); padding: 25px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); border: 1px solid var(--border); margin-bottom: 20px; }
h2 { margin-top: 0; font-size: 1.2rem; display: flex; align-items: center; gap: 8px; }
h3 { font-size: 0.95rem; text-transform: uppercase; color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 5px; }

label { display: block; font-weight: 600; font-size: 0.85em; margin-bottom: 8px; color: var(--text); opacity: 0.9; }

/* Input Style for Text Mode with Spacing */
input, select { width: 100%; padding: 14px; border: 1px solid var(--border); border-radius: 10px; font-size: 16px; background: var(--bg); color: var(--text); box-sizing: border-box; margin-bottom: 15px; }
input:focus { border-color: var(--primary); outline: none; }

/* Checkbox & Radio Styles */
.checkbox-group { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; background: var(--bg); padding: 10px; border-radius: 8px; border: 1px solid var(--border); }
.checkbox-group label { margin: 0; cursor: pointer; }
.checkbox-group input { width: auto; margin: 0; }

/* Button Group for Calc & Reset */
.btn-group { display: flex; gap: 10px; margin-top: 10px; }
.btn-calc { flex: 2; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; }
.btn-calc:active { opacity: 0.9; transform: scale(0.98); }

.btn-reset { flex: 1; padding: 16px; background: transparent; border: 1px solid var(--border); color: var(--text); border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; }
.btn-reset:active { background: var(--bg); }

/* Results Box */
.result-box { margin-top: 20px; padding-top: 20px; border-top: 2px dashed var(--border); display: none; }
.res-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.95rem; }
.res-val { font-weight: bold; }
.res-total { font-size: 1.3rem; color: var(--accent); font-weight: 800; margin-top: 10px; text-align: right; }
.note { font-size: 0.8rem; color: var(--text); opacity: 0.7; margin-top: 15px; font-style: italic; }

/* Dark Mode Toggle */
.top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.theme-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; }

/* Legal Footer */
.footer {
font-size: 0.7rem;
color: var(--text);
opacity: 0.7;
text-align: center;
margin-top: 40px;
padding-bottom: 40px;
line-height: 1.6;
border-top: 1px solid var(--border);
padding-top: 20px;
}

/* Specific Affordability Results Styling */
.afford-row { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px dotted var(--border); }
.afford-row:last-child { border-bottom: none; }
.afford-total { font-size: 1.1rem; color: var(--danger); font-weight: bold; }

/* Overpayment Styling */
.overpay-save { background: var(--warning); padding: 15px; border-radius: 10px; margin-top: 15px; color: #333; }
.overpay-save p { margin: 0; font-weight: 700; }
</style>
</head>
<body>

<div class="wrapper">
<div class="top-bar">
<h1 style="margin:0; font-size:1.4rem;">üáøüá¶ The SA Wallet</h1>
<button class="theme-btn" onclick="toggleTheme()">üåì</button>
</div>

<div class="nav-tabs">
<button class="tab-btn active" onclick="switchTab('tax', this)">üí∏ Tax '26</button>
<button class="tab-btn" onclick="switchTab('afford', this)">‚úÖ Affordability</button>
<button class="tab-btn" onclick="switchTab('vehicle', this)">üöó Car</button>
<button class="tab-btn" onclick="switchTab('bond', this)">üè† Bond</button>
<button class="tab-btn" onclick="switchTab('wealth', this)">üìà Savings</button>
</div>

<div id="tax" class="tool-section active">
<div class="card">
<h2>üí∏ Tax Estimator (2026)</h2>

<label>Income Frequency</label>
<select id="tax_period">
<option value="monthly">Monthly</option>
<option value="annual">Annual (Yearly Total)</option>
</select>

<label>Gross Income (R)</label>
<input type="text" inputmode="decimal" id="tax_income" placeholder="e.g. 25 000" onkeyup="formatCurrency(this)">

<label>Age Bracket</label>
<select id="tax_age">
<option value="primary">Under 65</option>
<option value="secondary">65 - 74</option>
<option value="tertiary">75 and older</option>
</select>

<div class="checkbox-group" id="bonus_group">
<label>Paid over 13 months? (Bonus)</label>
<input type="checkbox" id="tax_13th">
</div>

<h3>Deductions</h3>
<div class="checkbox-group">
<label>Deduct UIF? (1% capped)</label>
<input type="checkbox" id="tax_uif" checked>
</div>

<label>Provident/Pension Fund (Your Contribution %)</label>
<input type="number" id="tax_pension_perc" placeholder="e.g. 7" value="0" min="0">

<h3>Medical Aid Credits</h3>
<div class="checkbox-group">
<label>Do you pay Medical Aid?</label>
<input type="checkbox" id="tax_medical_active" onchange="toggleMedical()">
</div>
<div id="medical_inputs" style="display:none;">
<label>Total Members (Main + Dependents)</label>
<input type="number" id="tax_med_members" value="1" min="1">
</div>

<div class="btn-group">
<button class="btn-reset" onclick="resetTax()">Reset</button>
<button class="btn-calc" onclick="calcTax()">Estimate</button>
</div>

<div id="res-tax" class="result-box">
<div class="res-row"><span>Gross Income (Annual):</span> <span class="res-val" id="rt_gross">R0</span></div>
<div class="res-row"><span>Taxable Income:</span> <span class="res-val" id="rt_taxable">R0</span></div>
<div class="res-row" style="color:#ef4444;"><span>Annual Tax (PAYE):</span> <span class="res-val" id="rt_annual_tax">R0</span></div>
<div class="res-row" style="color:#ef4444;"><span>Deductions (Excl. Tax):</span> <span class="res-val" id="rt_annual_deduct">R0</span></div>
<div class="res-row" style="margin-top:15px; border-top:1px solid var(--border); padding-top:10px;">
<span style="font-weight:bold;">Monthly Take Home:</span>
</div>
<div class="res-total" id="rt_net">R0.00</div>
<div class="note" id="pay_note">Note: Monthly values shown are based on your selected frequency.</div>
</div>
</div>
</div>

<div id="afford" class="tool-section">
<div class="card">
<h2>‚úÖ Affordability Estimator</h2>
<label>Net Monthly Income (Take-Home Pay)</label>
<input type="text" inputmode="decimal" id="afford_net_income" placeholder="e.g. 20 000" onkeyup="formatCurrency(this)">

<label>How many people do you financially support?</label>
<select id="afford_household_size">
<option value="1">1 (Just me)</option>
<option value="2">2</option>
<option value="3">3 - 4</option>
<option value="5">5+</option>
</select>

<label>Existing Monthly Debt Payments (Total of all loans, cards, etc.)</label>
<input type="text" inputmode="decimal" id="afford_existing_debt" value="0" onkeyup="formatCurrency(this)">

<label>Bond Term (Years)</label>
<select id="afford_bond_years" onchange="updateAffordLabels()">
<option value="20">20 Years</option>
<option value="30">30 Years</option>
<option value="15">15 Years</option>
</select>
<label>Default Interest Rate (%)</label>
<input type="number" id="afford_rate" value="11.75" min="0">

<div class="btn-group">
<button class="btn-reset" onclick="resetAfford()">Reset</button>
<button class="btn-calc" onclick="calcAfford()">Calculate</button>
</div>

<div id="res-afford" class="result-box">
<h3>Based on Bank Rules (35% DTI & Living Costs)</h3>

<div class="afford-row">
<div class="res-row"><span>Max Monthly Debt Capacity:</span> <span class="afford-total" id="ra_capacity">R0</span></div>
<div class="note">This is the maximum repayment amount banks generally allow you.</div>
</div>

<div class="afford-row">
<div class="res-row"><span>Remaining Monthly Budget:</span> <span class="afford-total" id="ra_remaining_budget">R0</span></div>
<div class="note">This is the maximum monthly instalment you can spend on *new* debt (Car OR Bond).</div>
</div>

<div class="afford-row" style="background: var(--bg); padding: 10px; border-radius: 8px;">
<label style="color:var(--primary); font-size:1.0em;">Max Bond Affordability (<span id="bondYearsLabel">20</span> Years):</label>
<div class="res-total" id="ra_max_bond">R0</div>
</div>

<div class="afford-row" style="background: var(--bg); padding: 10px; border-radius: 8px;">
<label style="color:var(--primary); font-size:1.0em;">Max Car Price Affordability (5 Years):</label>
<div class="res-total" id="ra_max_car">R0</div>
</div>

<div class="note">
You can afford **either** the maximum car **OR** the maximum bond shown, but not both at the same time, as this would exceed your remaining budget.
</div>
</div>
</div>
</div>

<div id="vehicle" class="tool-section">
<div class="card">
<h2>üöó Vehicle Finance</h2>
<label>Vehicle Price (R)</label>
<input type="text" inputmode="decimal" id="car_price" placeholder="e.g. 300 000" onkeyup="formatCurrency(this)">
<label>Deposit (Optional)</label>
<input type="text" inputmode="decimal" id="car_deposit" value="0" onkeyup="formatCurrency(this)">

<label>Balloon Payment / Residual (%)</label>
<input type="number" id="car_balloon_perc" placeholder="e.g. 30" value="0" min="0">

<label>Interest Rate (%)</label>
<input type="number" id="car_rate" value="11.75" min="0">
<label>Payment Period</label>
<select id="car_months">
<option value="60">60 Months (5 Years)</option>
<option value="48">48 Months (4 Years)</option>
<option value="54">54 Months (4.5 Years)</option>
<option value="72">72 Months (6 Years)</option>
<option value="84">84 Months (7 Years)</option>
<option value="96">96 Months (8 Years)</option>
</select>

<label>Extra Monthly Payment (Optional)</label>
<input type="text" inputmode="decimal" id="car_overpay" value="0" onkeyup="formatCurrency(this)">

<div class="btn-group">
<button class="btn-reset" onclick="resetCar()">Reset</button>
<button class="btn-calc" onclick="calcCar()">Estimate</button>
</div>

<div id="res-car" class="result-box">
<div class="res-row"><span>Loan Amount:</span> <span class="res-val" id="rc_loan">R0</span></div>
<div class="res-row"><span>Balloon Amount (Owed at end):</span> <span class="res-val" id="rc_balloon_amt">R0</span></div>
<div class="res-row"><span>Total Interest:</span> <span class="res-val" id="rc_interest">R0</span></div>
<div class="res-total" id="rc_total">R0 /pm</div>
<div id="rc_overpay_result" class="overpay-save" style="display:none;"></div>
<p id="rc_overpay_note" class="note" style="display:none; margin-top:-5px;">*Overpayment savings are estimates.</p>
</div>
</div>
</div>

<div id="bond" class="tool-section">
<div class="card">
<h2>üè† Bond Repayment</h2>
<label>Property Price (R)</label>
<input type="text" inputmode="decimal" id="bond_price" placeholder="e.g. 1 200 000" onkeyup="formatCurrency(this)">

<label>Deposit (Optional)</label>
<input type="text" inputmode="decimal" id="bond_deposit" value="0" onkeyup="formatCurrency(this)">

<label>Interest Rate (%)</label>
<input type="number" id="bond_rate" value="11.75" min="0">
<label>Term (Years)</label>
<select id="bond_years">
<option value="20">20 Years</option>
<option value="30">30 Years</option>
<option value="15">15 Years</option>
</select>

<label>Extra Monthly Payment (Optional)</label>
<input type="text" inputmode="decimal" id="bond_overpay" value="0" onkeyup="formatCurrency(this)">

<div class="btn-group">
<button class="btn-reset" onclick="resetBond()">Reset</button>
<button class="btn-calc" onclick="calcBond()">Estimate</button>
</div>

<div id="res-bond" class="result-box">
<div class="res-row"><span>Loan Amount:</span> <span class="res-val" id="rb_loan">R0</span></div>
<div class="res-row"><span>Total Cost over term:</span> <span class="res-val" id="rb_total_cost">R0</span></div>
<div class="res-total" id="rb_monthly">R0 /pm</div>
<div id="rb_overpay_result" class="overpay-save" style="display:none;"></div>
<p id="rb_overpay_note" class="note" style="display:none; margin-top:-5px;">*Overpayment savings are estimates.</p>
</div>
</div>
</div>

<div id="wealth" class="tool-section">
<div class="card">
<h2>üìà Savings Planner</h2>
<label>Starting Amount (R)</label>
<input type="text" inputmode="decimal" id="save_start" value="1 000" onkeyup="formatCurrency(this)">

<label>Monthly Contribution (R)</label>
<input type="text" inputmode="decimal" id="save_monthly" value="500" onkeyup="formatCurrency(this)">

<label>Annual Return (%)</label>
<input type="number" id="save_rate" value="10" min="0">
<label>Years</label>
<input type="number" id="save_years" value="10" min="1">

<div class="btn-group">
<button class="btn-reset" onclick="resetSave()">Reset</button>
<button class="btn-calc" onclick="calcSave()">Project</button>
</div>

<div id="res-save" class="result-box">
<div class="res-row"><span>Total Contributed:</span> <span class="res-val" id="rs_contrib">R0</span></div>
<div class="res-row" style="color:var(--accent);"><span>Interest Earned:</span> <span class="res-val" id="rs_interest">R0</span></div>
<div class="res-total" id="rs_final">R0.00</div>
</div>
</div>
</div>

<div class="footer">
<p><strong>LEGAL DISCLAIMER:</strong> This tool is for educational purposes only. Calculations are estimates based on the 2025/2026 SARS Budget Speech.</p>
<p><strong>Medical credits, UIF caps, and tax brackets are subject to change without notice.</strong></p>
<p>The creators of this tool are <strong>not registered Financial Services Providers (FSP)</strong>. We accept no liability for any loss or damage resulting from the use of this tool. Please consult a certified tax practitioner or financial advisor before making any financial decisions.</p>
<p>&copy; 2026 The SA Wallet</p>
</div>
</div>

<script>
function switchTab(id, btn) {
document.querySelectorAll('.tool-section').forEach(el => el.classList.remove('active'));
document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
document.getElementById(id).classList.add('active');
btn.classList.add('active');
}

function toggleMedical() {
const isActive = document.getElementById('tax_medical_active').checked;
document.getElementById('medical_inputs').style.display = isActive ? 'block' : 'none';
}

// --- FORMATTING ENGINE ---
function formatCurrency(input) {
let value = input.value.replace(/[^0-9.]/g, '');
let parts = value.split('.');
parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, " ");
input.value = parts.join('.');
}

function getVal(id) {
const raw = document.getElementById(id).value;
const clean = raw.replace(/ /g, '');
return Math.max(0, parseFloat(clean) || 0);
}

const fmt = new Intl.NumberFormat('en-ZA', { style: 'currency', currency: 'ZAR' });

// Function to calculate remaining months given overpayment
function calcMonthsToZero(P, r_monthly, M, overpay) {
if (P <= 0 || M <= 0) return 0;
let balance = P;
let totalPayment = M + overpay;
let months = 0;

if (totalPayment <= M) return 9999;

while (balance > 0 && months < 3600) {
months++;
let interest = balance * r_monthly;
let principalPaid = totalPayment - interest;
balance -= principalPaid;
}
return months;
}

// --- RESET FUNCTIONS ---
function resetTax() {
document.getElementById('tax_income').value = '';
document.getElementById('tax_period').value = 'monthly';
document.getElementById('tax_age').value = 'primary';
document.getElementById('tax_13th').checked = false;
document.getElementById('tax_uif').checked = true;
document.getElementById('tax_pension_perc').value = 0;
document.getElementById('tax_medical_active').checked = false;
document.getElementById('tax_med_members').value = 1;
document.getElementById('medical_inputs').style.display = 'none';
document.getElementById('res-tax').style.display = 'none';
}

// Updates the Affordability Bond Years Label
function updateAffordLabels() {
const selectedYear = document.getElementById('afford_bond_years').value;
document.getElementById('bondYearsLabel').innerText = selectedYear;
}

function resetAfford() {
document.getElementById('afford_net_income').value = '';
document.getElementById('afford_existing_debt').value = '0';
document.getElementById('afford_bond_years').value = '20';
document.getElementById('afford_rate').value = 11.75;
document.getElementById('afford_household_size').value = '1';
document.getElementById('res-afford').style.display = 'none';
updateAffordLabels();
}

function resetCar() {
document.getElementById('car_price').value = '';
document.getElementById('car_deposit').value = '0';
document.getElementById('car_balloon_perc').value = 0;
document.getElementById('car_rate').value = 11.75;
document.getElementById('car_months').value = 60;
document.getElementById('car_overpay').value = '0';
document.getElementById('res-car').style.display = 'none';
document.getElementById('rc_overpay_result').style.display = 'none';
document.getElementById('rc_overpay_note').style.display = 'none';
}

function resetBond() {
document.getElementById('bond_price').value = '';
document.getElementById('bond_deposit').value = '0';
document.getElementById('bond_rate').value = 11.75;
document.getElementById('bond_years').value = 20;
document.getElementById('bond_overpay').value = '0';
document.getElementById('res-bond').style.display = 'none';
document.getElementById('rb_overpay_result').style.display = 'none';
document.getElementById('rb_overpay_note').style.display = 'none';
}

function resetSave() {
document.getElementById('save_start').value = '1 000';
document.getElementById('save_monthly').value = '500';
document.getElementById('save_rate').value = 10;
document.getElementById('save_years').value = 10;
document.getElementById('res-save').style.display = 'none';
}

// --- CALCULATION LOGIC ---

// 1. TAX LOGIC (Full 2026 Calculation)
function calcTax() {
const amount = getVal('tax_income');
const period = document.getElementById('tax_period').value;
const use13th = document.getElementById('tax_13th').checked;
const divisor = use13th ? 13 : 12;

let annualGross = 0;
if (period === 'annual') { annualGross = amount; }
else { annualGross = use13th ? amount * 13 : amount * 12; }

const pensionPerc = getVal('tax_pension_perc');
const pensionDedAnnual = annualGross * (pensionPerc / 100);
const taxableIncome = Math.max(0, annualGross - pensionDedAnnual);

let tax = 0;
// 2026 SARS Brackets
if (taxableIncome <= 237100) { tax = taxableIncome * 0.18; }
else if (taxableIncome <= 370500) { tax = 42678 + (taxableIncome - 237100) * 0.26; }
else if (taxableIncome <= 512800) { tax = 77362 + (taxableIncome - 370500) * 0.31; }
else if (taxableIncome <= 673000) { tax = 121475 + (taxableIncome - 512800) * 0.36; }
else if (taxableIncome <= 857900) { tax = 179147 + (taxableIncome - 673000) * 0.39; }
else if (taxableIncome <= 1817000) { tax = 251258 + (taxableIncome - 857900) * 0.41; }
else { tax = 644489 + (taxableIncome - 1817000) * 0.45; }

const age = document.getElementById('tax_age').value;
let rebate = 17235;
if (age === 'secondary') rebate += 9444;
if (age === 'tertiary') rebate += (9444 + 3145);
tax = Math.max(0, tax - rebate);

let medCreditAnnual = 0;
if (document.getElementById('tax_medical_active').checked) {
const members = getVal('tax_med_members');
let monthlyCredit = 0;
if (members >= 1) monthlyCredit += 364;
if (members >= 2) monthlyCredit += 364;
if (members > 2) monthlyCredit += (members - 2) * 246;
medCreditAnnual = monthlyCredit * 12;
}

tax = Math.max(0, tax - medCreditAnnual);

let uifAnnual = 0;
if (document.getElementById('tax_uif').checked) {
const monthlyGross = annualGross / 12;
const uifMonthly = Math.min(monthlyGross * 0.01, 177.12);
uifAnnual = uifMonthly * 12;
}

const annualNet = annualGross - tax - uifAnnual - pensionDedAnnual;
const monthlyNet = annualNet / divisor;

document.getElementById('rt_gross').innerText = fmt.format(annualGross);
document.getElementById('rt_taxable').innerText = fmt.format(taxableIncome);
document.getElementById('rt_annual_tax').innerText = fmt.format(tax);
document.getElementById('rt_annual_deduct').innerText = fmt.format(uifAnnual + pensionDedAnnual);
document.getElementById('rt_net').innerText = fmt.format(monthlyNet);

const noteText = use13th ?
"Note: Monthly pay is calculated as (Annual Net / 13) because you selected a 13th cheque." :
"Note: Monthly pay is calculated as (Annual Net / 12).";
document.getElementById('pay_note').innerText = noteText;

document.getElementById('res-tax').style.display = 'block';
}

// 2. AFFORDABILITY LOGIC (V2.6: Incorporates Living Expenses)
function calcAfford() {
const netIncome = getVal('afford_net_income');
const existingDebt = getVal('afford_existing_debt');
const rate = getVal('afford_rate');
const bondYears = parseFloat(document.getElementById('afford_bond_years').value);
const carMonths = 60; // Standard 5 years
const householdSize = document.getElementById('afford_household_size').value;

// Living Expense Benchmarks based on common SA estimates
let livingExpenseBenchmark = 0;
if (householdSize === '1') livingExpenseBenchmark = 6000;
else if (householdSize === '2') livingExpenseBenchmark = 9000;
else if (householdSize === '3') livingExpenseBenchmark = 12000; // Covers 3-4 people
else if (householdSize === '5') livingExpenseBenchmark = 15000; // Covers 5+ people

// 1. Calculate DISPOSABLE INCOME (Income minus essential living costs)
const disposableIncome = netIncome - livingExpenseBenchmark;

// 2. Calculate MAX DEBT CAPACITY (35% DTI rule based on Gross/Net, used here as safety cap)
const maxDebtCapacity = netIncome * 0.35;

// 3. The actual available budget for NEW loans is the MINIMUM of:
// a) What's left after living expenses, AND
// b) What the bank allows after existing debt.

// The Remaining Budget will be the minimum of:
// (Disposable Income minus Existing Debt) OR (Max DTI minus Existing Debt)
const remainingBudgetBasedOnDisposable = Math.max(0, disposableIncome - existingDebt);
const remainingBudgetBasedOnDTI = Math.max(0, maxDebtCapacity - existingDebt);

const remainingBudget = Math.min(remainingBudgetBasedOnDisposable, remainingBudgetBasedOnDTI);

// --- BOND REVERSE CALCULATION ---
const r_bond = (rate / 100) / 12;
const n_bond = bondYears * 12;
const P_bond = (remainingBudget * (Math.pow(1 + r_bond, n_bond) - 1)) / (r_bond * Math.pow(1 + r_bond, n_bond));

// --- CAR REVERSE CALCULATION ---
// Max car payment is the MINIMUM of (20% of net income) OR (the total remaining budget).
const maxCarPaymentBudget = Math.min(netIncome * 0.20, remainingBudget);

const r_car = (rate / 100) / 12;
const n_car = carMonths;
const P_car = (maxCarPaymentBudget * (Math.pow(1 + r_car, n_car) - 1)) / (r_car * Math.pow(1 + r_car, n_car));

// Display results
updateAffordLabels();
document.getElementById('ra_capacity').innerText = fmt.format(maxDebtCapacity); // Shows the DTI Cap
document.getElementById('ra_remaining_budget').innerText = fmt.format(remainingBudget); // Shows the actual limit
document.getElementById('ra_max_bond').innerText = fmt.format(P_bond);
document.getElementById('ra_max_car').innerText = fmt.format(P_car);

document.getElementById('res-afford').style.display = 'block';
}

// 3. VEHICLE LOGIC (Overpayment)
function calcCar() {
const price = getVal('car_price');
const deposit = getVal('car_deposit');
const balloonPerc = getVal('car_balloon_perc');
const overpay = getVal('car_overpay');

const principal = Math.max(0, price - deposit);
const balloonAmount = price * (balloonPerc / 100);
const r = (getVal('car_rate')) / 100 / 12;
const n_orig = parseFloat(document.getElementById('car_months').value);

const loanPortion = principal - balloonAmount;
const paymentLoan = (loanPortion * r * Math.pow(1 + r, n_orig)) / (Math.pow(1 + r, n_orig) - 1);
const paymentBalloon = balloonAmount * r;
const totalMonthly = paymentLoan + paymentBalloon;
const totalInterest = (totalMonthly * n_orig) + balloonAmount - principal;

document.getElementById('rc_loan').innerText = fmt.format(principal);
document.getElementById('rc_balloon_amt').innerText = fmt.format(balloonAmount);
document.getElementById('rc_interest').innerText = fmt.format(totalInterest);
document.getElementById('rc_total').innerText = fmt.format(totalMonthly) + " /pm";

// --- Overpayment Calculation ---
const P_no_balloon = principal - balloonAmount;
if (overpay > 0 && P_no_balloon > 0) {
const M_no_balloon = (principal * r * Math.pow(1 + r, n_orig)) / (Math.pow(1 + r, n_orig) - 1);

const monthsToZero = calcMonthsToZero(principal, r, M_no_balloon, overpay);
const yearsSaved = (n_orig - monthsToZero) / 12;
const newTotalCost = (M_no_balloon + overpay) * monthsToZero;
const interestSaved = totalInterest - (newTotalCost - principal) + balloonAmount;

if(monthsToZero < n_orig) {
document.getElementById('rc_overpay_result').innerHTML =
`<p>Extra R${fmt.format(overpay).slice(1)}/pm saves you **${Math.round(yearsSaved * 10) / 10} years** and **${fmt.format(interestSaved)}** in interest!</p>`;
document.getElementById('rc_overpay_result').style.display = 'block';
document.getElementById('rc_overpay_note').style.display = 'block';
} else {
document.getElementById('rc_overpay_result').style.display = 'none';
document.getElementById('rc_overpay_note').style.display = 'none';
}
} else {
document.getElementById('rc_overpay_result').style.display = 'none';
document.getElementById('rc_overpay_note').style.display = 'none';
}

document.getElementById('res-car').style.display = 'block';
}

// 4. BOND LOGIC (Overpayment)
function calcBond() {
const price = getVal('bond_price');
const deposit = getVal('bond_deposit');
const overpay = getVal('bond_overpay');
const P = Math.max(0, price - deposit);
const r = (getVal('bond_rate')) / 100 / 12;
const n_orig = (parseFloat(document.getElementById('bond_years').value) || 0) * 12;

const monthly = (P * r * Math.pow(1 + r, n_orig)) / (Math.pow(1 + r, n_orig) - 1);
const total = monthly * n_orig;

document.getElementById('rb_loan').innerText = fmt.format(P);
document.getElementById('rb_total_cost').innerText = fmt.format(total);
document.getElementById('rb_monthly').innerText = fmt.format(monthly) + " /pm";

// --- Overpayment Calculation ---
if (overpay > 0 && P > 0) {
const monthsToZero = calcMonthsToZero(P, r, monthly, overpay);
const yearsSaved = (n_orig - monthsToZero) / 12;
const newTotalCost = (monthly + overpay) * monthsToZero;
const interestSaved = total - newTotalCost;

if (monthsToZero < n_orig) {
document.getElementById('rb_overpay_result').innerHTML =
`<p>Extra R${fmt.format(overpay).slice(1)}/pm saves you **${Math.round(yearsSaved * 10) / 10} years** and **${fmt.format(interestSaved)}** in interest!</p>`;
document.getElementById('rb_overpay_result').style.display = 'block';
document.getElementById('rb_overpay_note').style.display = 'block';
} else {
document.getElementById('rb_overpay_result').style.display = 'none';
document.getElementById('rb_overpay_note').style.display = 'none';
}
} else {
document.getElementById('rb_overpay_result').style.display = 'none';
document.getElementById('rb_overpay_note').style.display = 'none';
}

document.getElementById('res-bond').style.display = 'block';
}

// 5. SAVINGS LOGIC
function calcSave() {
const P = getVal('save_start');
const PMT = getVal('save_monthly');
const r = getVal('save_rate') / 100 / 12;
const n = getVal('save_years') * 12;

let futureValue;
if (r === 0) { futureValue = P + (PMT * n); }
else { futureValue = P * Math.pow(1 + r, n) + (PMT * (Math.pow(1 + r, n) - 1)) / r; }

const totalContrib = P + (PMT * n);
document.getElementById('rs_contrib').innerText = fmt.format(totalContrib);
document.getElementById('rs_interest').innerText = fmt.format(futureValue - totalContrib);
document.getElementById('rs_final').innerText = fmt.format(futureValue);
document.getElementById('res-save').style.display = 'block';
}

function toggleTheme() {
const body = document.body;
const isDark = body.getAttribute('data-theme') === 'dark';
body.setAttribute('data-theme', isDark ? 'light' : 'dark');
}

// Set initial bond label on load
window.onload = function() {
updateAffordLabels();
};
</script>

</body>
</html>
